---
import MainLayout from "../../layouts/MainLayout.astro"
import type { musicFrontmatter } from "src/lib/utils"

const orderedPages = [
  "sway-machinery",
  "gordon-lockwood",
  "solo",
  "book-of-j",
  "composer-for-film-and-video",
  "fraternal-order-of-the-society-blues",
  "discography",
].map(slug => `/music/${slug}`)

interface PageData extends musicFrontmatter {
  url: string | undefined
}

// const pagesGlobData = await Astro.glob<musicFrontmatter>("./*.md")
// const pagesData = pagesGlobData.map<PageData>(({ frontmatter, url }) => ({
//   ...frontmatter,
//   url,
// }))
// const pages = orderedPages
//   .map(page => pagesData.find(data => data.url === page))
//   .filter(data => data !== undefined) as PageData[]

const pages = await Astro.glob<musicFrontmatter>("./*.md")
  .then(dataList => orderedPages.map(path => dataList.find(data => data.url === path)))
  .then(dataList =>
    dataList.map(data => (data ? { ...data.frontmatter, url: data.url } : null))
  )
  .then(dataList => dataList.filter(data => data !== null) as PageData[])
---

<MainLayout title="Music | Jeremiah Lockwood" active="music">
  <main>
    <h1>Music</h1>
    <div class="split">
      <figure>
        <iframe
          src="https://www.youtube.com/embed/d00yCDSjc_8"
          frameborder="0"
          allowfullscreen></iframe>
        <figcaption>Rozo D'Shabbos, The Sway Machinery</figcaption>
      </figure>
      <figure>
        <iframe
          src="https://www.youtube.com/embed/T1T3gzkj6bY"
          frameborder="0"
          allowfullscreen></iframe>
        <figcaption>Live at Sweetwater Music Hall, 2019</figcaption>
      </figure>
    </div>
    <div class="split">
      <blockquote>
        <p>
          <q>
            The musical story of Jeremiah Lockwood is almost hard to believe. His early
            musical development was guided by his grandfather, a Jewish cantor, and
            Carolina Slim, a well-known blues guitarist. All those influences crystallize
            into something unified.
          </q>
          -- Joe Tangari, Pitchfork
        </p>
      </blockquote>
      <blockquote>
        <p>
          <q>
            Jeremiah Lockwood &mldr; grew up with two disparate musical mentors. As a boy,
            Lockwood sang in the choir of his grandfather, Jacob Konigsberg, a renowned
            cantor who led the High Holidays services at the Loop Synagogue, in Chicago,
            for several decades. When he was fourteen, Lockwood began a lifelong
            apprenticeship with the legendary Piedmont blues master guitarist Carolina
            Slim, which mainly consisted of busking alongside the impeccably dressed Slim
            in Manhattan subway stations.
          </q>
          -- The New Yorker
        </p>
      </blockquote>
    </div>
    <div class="grid">
      {
        pages.map(({ title, image, previewText, url }) => (
          <div class="post">
            <a href={url}>
              <img src={image} alt={title} />
              <div class="card">
                <h3>{title}</h3>
                <p>{previewText}</p>
              </div>
            </a>
          </div>
        ))
      }
    </div>
    <aside>
      <p>
        Jeremiah Lockwood's music career began with over a decade of apprenticeship to the
        legendary Piedmont Blues musician Carolina Slim, playing in the subways of New
        York City. He also trained under his grandfather Cantor Jacob Konigsberg and
        performed in his choir. Jeremiah's band The Sway Machinery seeks inspiration from
        diverse realms of experience related to the cultural geography of New York City.
        The Sway Machinery has played around the world, including stints at legendary
        music festivals like Montreal Jazz, Roskilde, and perhaps most notably, Festival
        au Desert in Timbuktu, Mali. In addition to leading The Sway Machinery, Jeremiah
        toured for years as guitarist in the popular world-beat band Balkan Beat Box and
        has scored numerous film and video projects. Jeremiah was a recipient of the
        2007-8 Six Points Fellowship for Emerging Jewish Artists, was 2010
        Artist-in-Residence for the Forward and was a 2011 Brooklyn Philharmonic Orchestra
        Composer Fellow. Jeremiah's duo project with musician Jewlia Eisenberg, Book of J,
        released their debut album in 2018 to critical acclaim. Jeremiah has also produced
        an album of some of the young Chassidic cantors he worked with as part of his
        dissertation research; this album will be released in the next year.
      </p>
    </aside>
  </main>
</MainLayout>

<style>
  main {
    margin: 0;
    padding: 0;
  }
  h1 {
    text-align: center;
  }
  .grid {
    padding: 1em;
    display: grid;
    gap: 1em;
    grid-template-columns: repeat(3, 1fr);
  }
  .post {
    border: 1px solid;
    position: relative;
    overflow: hidden;
    aspect-ratio: 1 / 1;
  }
  .post .card {
    color: black;
    padding: 1em;
    background: hsl(0 15% 80% / 0.7);
    position: absolute;
    z-index: 5;
    inset: 0 0 auto 0;
    width: 100%;
    height: 100%;
    transform: translateY(-100%);
    transition: transform 300ms;
    overflow: hidden;
  }
  .post .card h3 {
    margin-bottom: 0.5rem;
  }
  .post .card p {
    font-size: clamp(0.4rem, 1vw + 0.5rem);
  }
  .post img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .post:hover .card {
    transform: none;
  }

  @media screen and (max-width: 1100px) {
    .post .card {
      transform: none;
      height: auto;
    }
  }

  @media screen and (max-width: 700px) {
    .grid {
      grid-template-columns: 1fr 1fr;
      /* aspect-ratio: 1 / 2; */
    }
    .post .card p {
      display: none;
    }
  }

  aside {
    font-size: 1.5em;
    line-height: 1.2em;
    margin: 5em auto;
    max-width: clamp(30ch, 75vw, 70ch);
  }

  blockquote p {
    font-size: 1.3em;
  }
</style>
